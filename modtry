-- CLEAN VERSION (NO KICK)
-- Original GUI preserved
-- Unsafe exploit logic removed

local Players = game:GetService("Players")
local ProximityPromptService = game:GetService("ProximityPromptService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local savedCFrame = nil
local tpEnabled = false

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "InstaStealHUD"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 280, 0, 200)
frame.Position = UDim2.new(0.5, -140, 0.5, -100)
frame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
frame.BorderSizePixel = 0
frame.Parent = gui

Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 14)

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(120, 120, 120)
stroke.Thickness = 2
stroke.Parent = frame

local header = Instance.new("TextLabel")
header.Size = UDim2.new(1, -20, 0, 28)
header.Position = UDim2.new(0, 10, 0, 8)
header.BackgroundTransparency = 1
header.Text = "Instant Steal (Safe)"
header.Font = Enum.Font.GothamBold
header.TextSize = 16
header.TextColor3 = Color3.fromRGB(255,255,255)
header.Parent = frame

local function createButton(text, y)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -30, 0, 38)
	btn.Position = UDim2.new(0, 15, 0, y)
	btn.Text = text
	btn.Font = Enum.Font.GothamMedium
	btn.TextSize = 14
	btn.TextColor3 = Color3.new(1,1,1)
	btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
	btn.BorderSizePixel = 0
	btn.Parent = frame
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,10)
	return btn
end

local setBtn = createButton("Set Checkpoint", 45)
local tpBtn = createButton("TP: OFF", 90)

local desyncBtn = Instance.new("TextButton")
desyncBtn.Size = UDim2.new(0,140,0,28)
desyncBtn.Position = UDim2.new(0.5,-70,0,135)
desyncBtn.Text = "Desync (Disabled)"
desyncBtn.Font = Enum.Font.GothamBold
desyncBtn.TextSize = 13
desyncBtn.TextColor3 = Color3.new(1,1,1)
desyncBtn.BackgroundColor3 = Color3.fromRGB(120,120,120)
desyncBtn.BorderSizePixel = 0
desyncBtn.Parent = frame
Instance.new("UICorner", desyncBtn).CornerRadius = UDim.new(0,8)

-- Button logic
setBtn.MouseButton1Click:Connect(function()
	local char = player.Character
	if char and char:FindFirstChild("HumanoidRootPart") then
		savedCFrame = char.HumanoidRootPart.CFrame
	end
end)

tpBtn.MouseButton1Click:Connect(function()
	tpEnabled = not tpEnabled
	tpBtn.Text = tpEnabled and "TP: ON" or "TP: OFF"
	tpBtn.BackgroundColor3 = tpEnabled
		and Color3.fromRGB(0,170,255)
		or Color3.fromRGB(70,70,70)
end)

-- SAFE prompt teleport
ProximityPromptService.PromptButtonHoldEnded:Connect(function(prompt, who)
	if who ~= player then return end
	if not tpEnabled or not savedCFrame then return end

	if prompt.Name == "Steal" or prompt.ActionText == "Steal" then
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			char.HumanoidRootPart.CFrame = savedCFrame
		end
	end
end)

-- Dragging
local dragging, dragStart, startPos

frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
	end
end)

frame.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
end)
